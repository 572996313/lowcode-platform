# 低代码平台开发计划

## 项目现状分析

### 已完成功能 ✅
- 菜单管理模块 (前后端完整)
- 表单设计器界面 (拖拽功能完成,未保存)
- 表格设计器界面 (配置功能完成,未保存)
- 后端 API 基础框架 (FormConfig, TableConfig, PageConfig Controller)

### 待开发功能 ❌
1. 用户认证系统
2. 表单/表格设计器保存功能
3. 页面设计器 (核心功能)
4. 字典管理系统
5. 用户管理系统
6. 按钮配置管理
7. 查询条件配置
8. 模板管理系统

---

## 开发阶段规划

### 第一阶段: 核心功能补全 (优先级: 高)

#### 1.1 表单设计器保存功能
**目标**: 将表单设计器的配置数据保存到数据库

**涉及文件**:
- 前端: `frontend/src/views/lowcode/FormDesigner.vue`
- 前端: `frontend/src/api/form.ts` (已存在,需调用)
- 后端: `FormConfigController.java` (已完成)

**开发任务**:
- [ ] 修改 FormDesigner.vue 的 `handleSave()` 方法
- [ ] 调用 `createForm()` 或 `updateForm()` API
- [ ] 处理保存成功/失败的提示
- [ ] 添加表单配置的加载功能 (编辑模式)

**预计工作量**: 2-3小时

---

#### 1.2 表格设计器保存功能
**目标**: 将表格设计器的配置数据保存到数据库

**涉及文件**:
- 前端: `frontend/src/views/lowcode/TableDesigner.vue`
- 前端: `frontend/src/api/table.ts` (已存在,需调用)
- 后端: `TableConfigController.java` (已完成)

**开发任务**:
- [ ] 修改 TableDesigner.vue 的 `handleSave()` 方法
- [ ] 调用 `createTable()` 或 `updateTable()` API
- [ ] 处理保存成功/失败的提示
- [ ] 添加表格配置的加载功能 (编辑模式)

**预计工作量**: 2-3小时

---

#### 1.3 用户认证系统
**目标**: 实现真实的 JWT 登录认证功能

**涉及文件**:
- 后端新增: `controller/AuthController.java`
- 后端新增: `service/AuthService.java`
- 后端新增: `entity/SysUser.java`
- 后端新增: `mapper/SysUserMapper.java`
- 后端修改: `config/SecurityConfig.java`
- 前端修改: `views/login/index.vue`
- 前端新增: `api/auth.ts`

**开发任务**:

**后端部分**:
- [ ] 创建 SysUser 实体类 (对应 sys_user 表)
- [ ] 创建 SysUserMapper 接口
- [ ] 创建 AuthService (登录验证、生成 JWT)
- [ ] 创建 AuthController (登录、登出、刷新 token 接口)
- [ ] 完善 SecurityConfig (配置 JWT 过滤器)
- [ ] 创建 JwtAuthenticationFilter (验证 token)

**前端部分**:
- [ ] 创建 auth.ts API 文件
- [ ] 修改 login/index.vue (对接真实登录接口)
- [ ] 修改 utils/request.ts (处理 401 跳转登录)
- [ ] 实现 token 刷新机制

**预计工作量**: 1天

---

#### 1.4 页面设计器 (核心功能)
**目标**: 实现可视化页面设计器,组合表单、表格、按钮等组件

**涉及文件**:
- 前端新增: `views/lowcode/PageDesigner.vue`
- 前端新增: `api/page.ts`
- 前端修改: `views/lowcode/PageManage.vue`
- 后端: `PageConfigController.java` (已完成)

**开发任务**:

**前端部分**:
- [ ] 创建 api/page.ts (定义页面配置 API)
- [ ] 创建 PageDesigner.vue 主组件
  - [ ] 左侧组件面板 (表单、表格、按钮、文本等)
  - [ ] 中间画布区域 (拖拽布局)
  - [ ] 右侧属性配置面板
- [ ] 实现组件拖拽功能
- [ ] 实现组件属性配置
- [ ] 实现页面配置保存
- [ ] 实现页面预览功能
- [ ] 修改 PageManage.vue (添加新增、编辑、设计按钮功能)

**数据结构设计**:
```json
{
  "layout": "default",
  "components": [
    {
      "type": "form",
      "id": "form_1",
      "formId": 1,
      "position": { "x": 0, "y": 0 }
    },
    {
      "type": "table",
      "id": "table_1",
      "tableId": 1,
      "position": { "x": 0, "y": 200 }
    }
  ]
}
```

**预计工作量**: 3-4天

---

### 第二阶段: 基础功能完善 (优先级: 中)

#### 2.1 字典管理系统
**目标**: 实现字典类型和字典数据的 CRUD 功能

**涉及文件**:
- 后端新增: `entity/SysDictType.java`
- 后端新增: `entity/SysDictData.java`
- 后端新增: `mapper/SysDictTypeMapper.java`
- 后端新增: `mapper/SysDictDataMapper.java`
- 后端新增: `service/SysDictService.java`
- 后端新增: `controller/DictController.java`
- 前端新增: `api/dict.ts`
- 前端新增: `views/system/DictManage.vue`

**开发任务**:

**后端部分**:
- [ ] 创建 SysDictType 实体类
- [ ] 创建 SysDictData 实体类
- [ ] 创建 Mapper 接口
- [ ] 创建 DictService (字典类型和数据的 CRUD)
- [ ] 创建 DictController (提供 REST API)
  - `GET /api/dict/type/list` - 字典类型列表
  - `GET /api/dict/data/list/{dictType}` - 根据类型获取字典数据
  - `POST /api/dict/type` - 创建字典类型
  - `POST /api/dict/data` - 创建字典数据
  - `PUT /api/dict/type/{id}` - 更新字典类型
  - `PUT /api/dict/data/{id}` - 更新字典数据
  - `DELETE /api/dict/type/{id}` - 删除字典类型
  - `DELETE /api/dict/data/{id}` - 删除字典数据

**前端部分**:
- [ ] 创建 api/dict.ts
- [ ] 创建 DictManage.vue
  - [ ] 左侧字典类型列表
  - [ ] 右侧字典数据列表
  - [ ] 字典类型的增删改查
  - [ ] 字典数据的增删改查

**预计工作量**: 1天

---

#### 2.2 用户管理系统
**目标**: 实现用户的 CRUD 功能

**涉及文件**:
- 后端: `entity/SysUser.java` (在 1.3 已创建)
- 后端: `mapper/SysUserMapper.java` (在 1.3 已创建)
- 后端新增: `service/SysUserService.java`
- 后端新增: `controller/UserController.java`
- 前端新增: `api/user.ts`
- 前端新增: `views/system/UserManage.vue`

**开发任务**:

**后端部分**:
- [ ] 创建 SysUserService (用户 CRUD、密码重置)
- [ ] 创建 UserController
  - `GET /api/user/list` - 用户列表 (分页)
  - `GET /api/user/{id}` - 用户详情
  - `POST /api/user` - 创建用户
  - `PUT /api/user/{id}` - 更新用户
  - `DELETE /api/user/{id}` - 删除用户
  - `PUT /api/user/{id}/password` - 重置密码

**前端部分**:
- [ ] 创建 api/user.ts
- [ ] 创建 UserManage.vue
  - [ ] 用户列表 (表格)
  - [ ] 搜索功能 (用户名、手机号)
  - [ ] 新增用户对话框
  - [ ] 编辑用户对话框
  - [ ] 删除确认
  - [ ] 重置密码功能

**预计工作量**: 1天

---

#### 2.3 按钮配置管理
**目标**: 实现按钮配置的 CRUD 功能,供页面设计器使用

**涉及文件**:
- 后端新增: `entity/LowButtonConfig.java`
- 后端新增: `mapper/LowButtonConfigMapper.java`
- 后端新增: `service/ButtonConfigService.java`
- 后端新增: `controller/ButtonConfigController.java`
- 前端新增: `api/button.ts`

**开发任务**:

**后端部分**:
- [ ] 创建 LowButtonConfig 实体类
- [ ] 创建 ButtonConfigMapper 接口
- [ ] 创建 ButtonConfigService
- [ ] 创建 ButtonConfigController
  - `GET /api/button/list` - 按钮配置列表
  - `GET /api/button/{id}` - 按钮配置详情
  - `POST /api/button` - 创建按钮配置
  - `PUT /api/button/{id}` - 更新按钮配置
  - `DELETE /api/button/{id}` - 删除按钮配置

**前端部分**:
- [ ] 创建 api/button.ts
- [ ] 在 PageDesigner 中集成按钮组件
- [ ] 在 TableDesigner 中支持操作列按钮配置

**数据结构**:
```json
{
  "buttonName": "新增",
  "buttonType": "primary",
  "buttonIcon": "Plus",
  "actionType": "dialog",
  "actionConfig": {
    "dialogTitle": "新增用户",
    "formId": 1
  }
}
```

**预计工作量**: 0.5天

---

#### 2.4 查询条件配置
**目标**: 实现查询条件的可视化配置

**涉及文件**:
- 后端新增: `entity/LowSearchConfig.java`
- 后端新增: `mapper/LowSearchConfigMapper.java`
- 后端新增: `service/SearchConfigService.java`
- 后端新增: `controller/SearchConfigController.java`
- 前端新增: `api/search.ts`

**开发任务**:

**后端部分**:
- [ ] 创建 LowSearchConfig 实体类
- [ ] 创建 SearchConfigMapper 接口
- [ ] 创建 SearchConfigService
- [ ] 创建 SearchConfigController
  - `GET /api/search/list` - 查询配置列表
  - `GET /api/search/{id}` - 查询配置详情
  - `POST /api/search` - 创建查询配置
  - `PUT /api/search/{id}` - 更新查询配置
  - `DELETE /api/search/{id}` - 删除查询配置

**前端部分**:
- [ ] 创建 api/search.ts
- [ ] 在 TableDesigner 中添加查询条件配置面板
- [ ] 实现查询条件的动态渲染

**数据结构**:
```json
{
  "searchFields": [
    {
      "fieldName": "username",
      "fieldLabel": "用户名",
      "fieldType": "input",
      "operator": "like"
    },
    {
      "fieldName": "status",
      "fieldLabel": "状态",
      "fieldType": "select",
      "operator": "eq",
      "options": [
        { "label": "启用", "value": "1" },
        { "label": "禁用", "value": "0" }
      ]
    }
  ]
}
```

**预计工作量**: 1天

---

### 第三阶段: 高级功能增强 (优先级: 低)

#### 3.1 页面模板管理
**目标**: 实现页面模板的管理和应用

**涉及文件**:
- 后端新增: `entity/LowPageTemplate.java`
- 后端新增: `mapper/LowPageTemplateMapper.java`
- 后端新增: `service/PageTemplateService.java`
- 后端新增: `controller/PageTemplateController.java`
- 前端新增: `api/template.ts`
- 前端新增: `views/lowcode/TemplateManage.vue`

**开发任务**:

**后端部分**:
- [ ] 创建 LowPageTemplate 实体类
- [ ] 创建 PageTemplateMapper 接口
- [ ] 创建 PageTemplateService
- [ ] 创建 PageTemplateController
  - `GET /api/template/list` - 模板列表
  - `GET /api/template/{id}` - 模板详情
  - `POST /api/template` - 创建模板
  - `PUT /api/template/{id}` - 更新模板
  - `DELETE /api/template/{id}` - 删除模板

**前端部分**:
- [ ] 创建 api/template.ts
- [ ] 创建 TemplateManage.vue (模板管理页面)
- [ ] 在 PageDesigner 中添加"应用模板"功能
- [ ] 在 PageManage 中添加"从模板创建"功能

**预计工作量**: 1天

---

#### 3.2 数据源配置管理
**目标**: 实现多数据源配置,支持 SQL 和 API 数据源

**涉及文件**:
- 后端新增: `entity/LowDatasourceConfig.java`
- 后端新增: `mapper/LowDatasourceConfigMapper.java`
- 后端新增: `service/DatasourceConfigService.java`
- 后端新增: `controller/DatasourceConfigController.java`
- 前端新增: `api/datasource.ts`

**开发任务**:

**后端部分**:
- [ ] 创建 LowDatasourceConfig 实体类
- [ ] 创建 DatasourceConfigMapper 接口
- [ ] 创建 DatasourceConfigService
- [ ] 创建 DatasourceConfigController
  - `GET /api/datasource/list` - 数据源列表
  - `GET /api/datasource/{id}` - 数据源详情
  - `POST /api/datasource` - 创建数据源
  - `PUT /api/datasource/{id}` - 更新数据源
  - `DELETE /api/datasource/{id}` - 删除数据源
  - `POST /api/datasource/test` - 测试数据源连接

**前端部分**:
- [ ] 创建 api/datasource.ts
- [ ] 在 TableDesigner 中支持选择数据源
- [ ] 支持 SQL 数据源配置 (连接信息、SQL 语句)
- [ ] 支持 API 数据源配置 (URL、请求方法、参数)

**预计工作量**: 2天

---

#### 3.3 设计器功能增强

**3.3.1 表单设计器增强**
- [ ] 字段选项配置 (下拉框、单选、多选的选项来源)
  - 静态选项
  - 字典选项
  - API 选项
- [ ] 字段联动配置 (字段间的显示/隐藏联动)
- [ ] 表单校验规则的可视化配置
- [ ] 表单布局优化 (栅格布局、分组)

**3.3.2 表格设计器增强**
- [ ] 表格列的字典转换显示
- [ ] 自定义列渲染 (标签、图片、链接)
- [ ] 表格操作列配置 (编辑、删除、自定义按钮)
- [ ] 表格工具栏配置 (新增、导出、刷新)

**3.3.3 页面设计器增强**
- [ ] 组件库扩展 (图表、卡片、标签页等)
- [ ] 布局模板 (单列、两列、三列)
- [ ] 组件间数据联动
- [ ] 页面权限配置

**预计工作量**: 3-4天

---

#### 3.4 页面预览和发布
**目标**: 实现根据配置动态渲染页面

**涉及文件**:
- 前端新增: `views/lowcode/PagePreview.vue`
- 前端新增: `components/DynamicForm.vue`
- 前端新增: `components/DynamicTable.vue`
- 前端新增: `components/DynamicPage.vue`

**开发任务**:
- [ ] 创建 DynamicForm 组件 (根据表单配置动态渲染)
- [ ] 创建 DynamicTable 组件 (根据表格配置动态渲染)
- [ ] 创建 DynamicPage 组件 (根据页面配置动态渲染)
- [ ] 创建 PagePreview 页面 (预览模式)
- [ ] 实现页面发布功能 (生成路由、注册组件)
- [ ] 实现页面访问权限控制

**预计工作量**: 2-3天

---

## 开发顺序建议

### 快速见效路线 (推荐)
1. **表单设计器保存功能** (1.1) - 2-3小时
2. **表格设计器保存功能** (1.2) - 2-3小时
3. **用户认证系统** (1.3) - 1天
4. **字典管理系统** (2.1) - 1天
5. **页面设计器** (1.4) - 3-4天
6. **用户管理系统** (2.2) - 1天
7. **按钮配置管理** (2.3) - 0.5天
8. **查询条件配置** (2.4) - 1天
9. **页面模板管理** (3.1) - 1天
10. **设计器功能增强** (3.3) - 3-4天
11. **页面预览和发布** (3.4) - 2-3天
12. **数据源配置管理** (3.2) - 2天

**总预计工作量**: 约 15-20 天

---

## 技术难点预警

### 1. 页面设计器 (1.4)
**难点**:
- 组件拖拽和布局算法
- 组件间数据联动
- 配置数据结构设计

**建议**:
- 使用 Vue Draggable Plus 库
- 参考 form-create、vue-form-making 等开源项目
- 先实现基础拖拽,再逐步增强

### 2. 动态页面渲染 (3.4)
**难点**:
- 根据 JSON 配置动态生成组件
- 表单验证和数据提交
- 表格数据加载和分页

**建议**:
- 使用 Vue 的 `<component :is="componentType">` 动态组件
- 使用 Element Plus 的表单验证规则
- 封装统一的数据请求方法

### 3. 权限控制
**难点**:
- JWT token 的生成和验证
- 前端路由权限控制
- 按钮级权限控制

**建议**:
- 使用 Spring Security + JWT
- 前端使用路由守卫 (beforeEach)
- 使用自定义指令 `v-permission`

---

## 数据库表关系图

```
sys_menu (菜单表)
  └─ 树形结构 (parent_id)

sys_user (用户表)
  └─ 关联角色 (未实现)

sys_dict_type (字典类型表)
  └─ sys_dict_data (字典数据表)
      └─ 外键: dict_type

low_page_config (页面配置表)
  └─ config_json 包含:
      ├─ low_form_config (表单配置)
      ├─ low_table_config (表格配置)
      └─ low_button_config (按钮配置)

low_form_config (表单配置表)
  └─ low_form_field (表单字段表)
      └─ 外键: form_id

low_table_config (表格配置表)
  ├─ low_table_column (表格列表)
  │   └─ 外键: table_id
  └─ low_search_config (查询条件表)
      └─ 外键: table_id

low_page_template (页面模板表)
  └─ 被 low_page_config 引用

low_datasource_config (数据源配置表)
  └─ 被 low_table_config 引用
```

---

## 开发环境准备

### 前端环境
```bash
cd lowcode-platform/frontend
npm install
npm run dev  # http://localhost:3000
```

### 后端环境
```bash
cd lowcode-platform/backend
mvn clean install
mvn spring-boot:run  # http://localhost:8080
```

### 数据库初始化
```bash
mysql -u root -p < lowcode-platform/docs/init.sql
```

### API 文档访问
- Swagger UI: http://localhost:8080/swagger-ui.html
- Knife4j: http://localhost:8080/doc.html

---

## 代码规范

### 后端规范
- 实体类使用 Lombok `@Data`, `@Builder`
- Controller 返回统一格式 `Result<T>`
- Service 层处理业务逻辑
- Mapper 层使用 MyBatis Plus BaseMapper

### 前端规范
- 使用 TypeScript 类型定义
- API 接口统一放在 `src/api/` 目录
- 组件使用 `<script setup>` 语法
- 使用 Element Plus 组件库

---

## 测试计划

### 单元测试
- [ ] 后端 Service 层单元测试
- [ ] 前端工具函数单元测试

### 集成测试
- [ ] API 接口测试 (Postman/Apifox)
- [ ] 前后端联调测试

### 功能测试
- [ ] 表单设计器功能测试
- [ ] 表格设计器功能测试
- [ ] 页面设计器功能测试
- [ ] 权限控制测试

---

## 部署计划

### 前端部署
```bash
npm run build
# 将 dist 目录部署到 Nginx
```

### 后端部署
```bash
mvn clean package
# 运行 target/lowcode-platform-backend.jar
```

### Docker 部署 (可选)
- [ ] 编写 Dockerfile
- [ ] 编写 docker-compose.yml
- [ ] 配置 MySQL、Redis 容器

---

## 下一步行动

请选择要开始的任务:
1. **表单设计器保存功能** (最快见效)
2. **表格设计器保存功能** (最快见效)
3. **用户认证系统** (基础功能)
4. **页面设计器** (核心功能,工作量大)

确认后我将开始编写代码!
