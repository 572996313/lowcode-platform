# 按钮配置功能测试指南

## 环境准备

### 1. 数据库初始化
确保数据库中已创建 `low_button_config` 表：
```bash
mysql -u root -p lowcode_platform < docs/init.sql
```

### 2. 启动后端服务
```bash
cd backend
mvn spring-boot:run
```
访问地址：http://localhost:8080
API 文档：http://localhost:8080/doc.html

### 3. 启动前端服务
```bash
cd frontend
npm run dev
```
访问地址：http://localhost:3000

## 功能测试

### 测试一：后端 API 测试

#### 1.1 测试创建按钮
使用 Postman 或访问 http://localhost:8080/doc.html

**请求示例：**
```http
POST /api/button
Content-Type: application/json

{
  "buttonName": "新增用户",
  "buttonCode": "add_user",
  "pageId": 1,
  "position": "toolbar",
  "buttonType": "primary",
  "buttonSize": "default",
  "icon": "Plus",
  "actionType": "dialog",
  "actionConfig": "{\"formId\":1,\"title\":\"新增用户\",\"width\":\"600px\",\"mode\":\"add\"}",
  "visible": true
}
```

**预期结果：** 返回创建的按钮 ID

#### 1.2 测试查询按钮列表
```http
GET /api/button/list?current=1&size=10
```

**预期结果：** 返回分页的按钮列表

#### 1.3 测试按页面查询按钮
```http
GET /api/button/page/1
```

**预期结果：** 返回页面 ID 为 1 的所有按钮

#### 1.4 测试更新按钮
```http
PUT /api/button/1
Content-Type: application/json

{
  "buttonName": "添加用户",
  "buttonCode": "add_user",
  "buttonType": "success"
}
```

**预期结果：** 更新成功

#### 1.5 测试删除按钮
```http
DELETE /api/button/1
```

**预期结果：** 删除成功（逻辑删除）

### 测试二：表单设计器按钮配置

#### 2.1 打开表单设计器
1. 访问 http://localhost:3000
2. 登录系统
3. 进入"表单管理"页面
4. 点击"新建表单"或选择已有表单进行编辑

#### 2.2 配置表单按钮
1. 在表单设计器中，切换到"按钮配置"标签页
2. 点击"添加按钮"
3. 配置按钮属性：
   - 按钮名称：提交
   - 按钮编码：submit
   - 按钮位置：footer
   - 按钮类型：primary
   - 动作类型：api
   - 动作配置：
     ```json
     {
       "url": "/api/form/submit",
       "method": "POST"
     }
     ```

#### 2.3 测试按钮操作
- [ ] 添加按钮
- [ ] 编辑按钮属性
- [ ] 删除按钮
- [ ] 按钮上移/下移
- [ ] 选择不同动作类型
- [ ] 配置动作参数

### 测试三：表格设计器按钮配置

#### 3.1 打开表格设计器
1. 进入"表格管理"页面
2. 点击"新建表格"或选择已有表格进行编辑

#### 3.2 配置工具栏按钮
1. 在表格设计器中，切换到"按钮配置"标签页
2. 展开"工具栏按钮"
3. 点击"添加"按钮
4. 配置按钮属性：
   - 按钮名称：新增
   - 按钮编码：add
   - 按钮类型：primary
   - 图标：Plus
   - 动作类型：dialog
   - 动作配置：
     ```json
     {
       "formId": 1,
       "title": "新增用户",
       "width": "600px",
       "mode": "add"
     }
     ```

#### 3.3 配置操作列按钮
1. 展开"操作列按钮"
2. 点击"添加"按钮
3. 配置按钮属性：
   - 按钮名称：编辑
   - 按钮编码：edit
   - 按钮类型：primary
   - 按钮尺寸：small
   - 朴素按钮：是
   - 动作类型：dialog
   - 动作配置：
     ```json
     {
       "formId": 1,
       "title": "编辑用户",
       "width": "600px",
       "mode": "edit",
       "dataUrl": "/api/user/detail"
     }
     ```

4. 再添加一个删除按钮：
   - 按钮名称：删除
   - 按钮编码：delete
   - 按钮类型：danger
   - 按钮尺寸：small
   - 动作类型：confirm
   - 确认框配置：
     ```json
     {
       "title": "确认删除",
       "message": "确定要删除吗？",
       "type": "warning"
     }
     ```
   - 动作配置：
     ```json
     {
       "url": "/api/user/delete",
       "method": "POST",
       "params": {
         "fromRow": true
       },
       "successAction": {
         "type": "refresh",
         "message": "删除成功"
       }
     }
     ```

#### 3.4 测试按钮预览
- [ ] 查看工具栏按钮预览
- [ ] 查看操作列按钮预览
- [ ] 验证按钮样式正确

### 测试四：按钮渲染和动作执行

注意：此部分需要在实际运行时页面中测试，目前仅实现了设计器部分。

#### 4.1 按钮渲染测试
- [ ] 按钮正确渲染
- [ ] 按钮样式正确应用
- [ ] 按钮图标正确显示
- [ ] 按钮禁用状态正确

#### 4.2 权限控制测试
- [ ] 有权限时显示按钮
- [ ] 无权限时隐藏按钮
- [ ] 权限标识正确传递

#### 4.3 显示条件测试
- [ ] 条件满足时显示按钮
- [ ] 条件不满足时隐藏按钮
- [ ] 表达式求值正确

#### 4.4 动作执行测试
- [ ] API 请求正确发送
- [ ] 弹窗正确打开（需实现）
- [ ] 抽屉正确打开（需实现）
- [ ] 路由跳转正确执行
- [ ] 确认框正确显示
- [ ] 自定义代码正确执行

## 常见问题

### 1. 后端编译失败
**问题：** Maven 编译失败
**解决：**
```bash
cd backend
mvn clean install -DskipTests
```

### 2. 前端构建失败
**问题：** vue-tsc 报错
**解决：** 使用 vite 直接构建
```bash
cd frontend
npx vite build
```

### 3. 按钮配置不保存
**问题：** 点击保存后按钮配置丢失
**原因：** 表单/表格保存时未同时保存按钮配置
**解决：** 需要在保存表单/表格时调用批量保存按钮接口

### 4. 按钮不显示
**问题：** 配置的按钮在页面中不显示
**原因：** 可能是以下原因之一：
  - visible 设置为 false
  - 权限检查未通过
  - 显示条件不满足
  - 位置配置错误

## 下一步开发

### 后端完善
1. 在保存表单/表格时自动保存按钮配置
2. 在查询表单/表格时自动返回按钮配置
3. 完善按钮配置的校验规则

### 前端完善
1. 实现按钮在实际页面中的渲染
2. 实现弹窗和抽屉动作
3. 集成权限系统
4. 添加按钮配置的导入导出功能

### 测试完善
1. 添加单元测试
2. 添加集成测试
3. 添加端到端测试

## 技术支持

如有问题，请查看：
- 后端 API 文档：http://localhost:8080/doc.html
- 前端开发文档：docs/开发计划.md
- 技术方案文档：docs/技术方案文档.md
