# 页面配置渲染功能 - 快速入门指南

## 功能概述

低代码平台的页面配置渲染功能允许您通过可视化配置快速生成业务页面，无需编写代码。支持列表页、表单页、左树右表等多种布局。

## 核心概念

### 1. 页面配置（PageConfig）
- **页面定义**：页面名称、编码、类型、布局
- **路由路径**：访问页面的URL路径，如 `/user/list`
- **发布状态**：页面发布后才能通过菜单访问

### 2. 查询区（SearchArea）
- **作用**：提供数据筛选条件
- **字段类型**：输入框、下拉框、日期选择、数字输入等
- **支持操作**：查询、重置

### 3. 内容区（ContentArea）
- **表格**：展示数据列表，支持分页、排序、选择
- **表单**：数据录入和编辑，支持验证和联动

### 4. 按钮（Button）
- **位置**：工具栏、行内、表单底部
- **动作类型**：API请求、弹窗、抽屉、路由跳转、确认框

## 快速开始

### 第一步：创建列表页面

**场景**：创建一个用户管理列表页

1. **创建页面**
   ```
   页面管理 → 新增页面 → 选择"列表页"模板
   页面名称：用户管理
   页面编码：user_manage
   点击确定
   ```

2. **设计页面**
   ```
   点击"设计"按钮 → 进入页面设计器
   ```

3. **配置查询区**
   - 启用查询区
   - 添加字段：
     ```
     用户名（input）
     状态（select，选项：启用=1/停用=0）
     创建时间（dateRange）
     ```

4. **配置内容区**
   - 类型：选择"表格"
   - 关联表格配置：选择已有的"用户列表"表格（或创建新表格）
   - 显示工具栏：勾选

5. **保存配置**

### 第二步：创建表格配置

1. **创建表格**
   ```
   表格管理 → 新增表格
   表格名称：用户列表
   表格编码：user_list
   API地址：/api/user/list
   请求方法：GET
   ```

2. **配置列**
   ```
   添加列：
   - ID（columnCode: id, width: 80）
   - 用户名（columnCode: username, width: 120）
   - 邮箱（columnCode: email, width: 200）
   - 状态（columnCode: status, width: 80, formatter: tag）
   - 创建时间（columnCode: createTime, width: 180, formatter: datetime）
   ```

3. **配置表格选项**
   ```
   分页：启用，每页10条
   选择框：启用
   序号：启用
   边框：启用
   斑马纹：启用
   ```

### 第三步：创建表单配置

1. **创建表单**
   ```
   表单管理 → 新增表单
   表单名称：用户表单
   表单编码：user_form
   布局列数：2列
   ```

2. **配置字段**
   ```
   添加字段：
   - 用户名（input，必填，占位符：请输入用户名）
   - 邮箱（input，必填，占位符：请输入邮箱）
   - 手机号（input，占位符：请输入手机号）
   - 状态（switch，默认值：1）
   - 备注（textarea，行数：3）
   ```

3. **配置验证规则**
   ```
   用户名：必填，最小长度2，最大长度20
   邮箱：必填，邮箱格式
   手机号：手机号格式
   ```

### 第四步：配置按钮

1. **工具栏按钮**
   ```
   按钮名称：新增用户
   按钮编码：user_add
   按钮类型：primary
   位置：toolbar
   图标：Plus
   动作类型：dialog
   动作配置：
   {
     "formId": 1,
     "title": "新增用户",
     "mode": "add",
     "submitUrl": "/api/user"
   }
   ```

2. **行内按钮**
   ```
   按钮名称：编辑
   按钮编码：user_edit
   位置：row
   动作类型：dialog
   动作配置：
   {
     "formId": 1,
     "title": "编辑用户",
     "mode": "edit",
     "dataUrl": "/api/user/{{row.id}}",
     "submitUrl": "/api/user/{{row.id}}",
     "submitMethod": "PUT"
   }

   按钮名称：删除
   按钮编码：user_delete
   位置：row
   按钮类型：danger
   动作类型：confirm
   确认框配置：
   {
     "title": "确认删除",
     "message": "确定要删除该用户吗？",
     "type": "warning"
   }
   动作配置：
   {
     "action": "api",
     "url": "/api/user/{{row.id}}",
     "method": "DELETE"
   }
   ```

### 第五步：发布页面

1. **发布页面**
   ```
   返回页面管理
   点击"发布"按钮
   输入路由路径：/user/list
   点击确定
   ```

2. **验证发布**
   ```
   确认页面状态显示为"已发布"
   确认路由路径显示为 "/user/list"
   ```

### 第六步：创建菜单

1. **新增菜单**
   ```
   菜单管理 → 新增菜单
   上级菜单：系统管理
   菜单类型：菜单
   菜单名称：用户管理
   菜单编码：user_manage
   ```

2. **关联页面**
   ```
   组件来源：选择"低代码页面"
   选择页面：用户管理 (/user/list)
   点击"自动填充"
   确认路由路径为：/user/list
   ```

3. **保存菜单**

### 第七步：访问页面

1. **刷新页面**
   ```
   按F5刷新浏览器
   ```

2. **找到菜单**
   ```
   左侧菜单 → 系统管理 → 用户管理
   ```

3. **访问页面**
   ```
   点击菜单
   页面将在右侧内容区渲染
   URL显示：http://localhost:3000/user/list
   ```

## 常见配置示例

### 1. 详情抽屉

```json
{
  "buttonName": "查看详情",
  "actionType": "drawer",
  "actionConfig": {
    "formId": 1,
    "title": "用户详情",
    "mode": "view",
    "dataUrl": "/api/user/{{row.id}}",
    "size": "large"
  }
}
```

### 2. 路由跳转

```json
{
  "buttonName": "查看报表",
  "actionType": "route",
  "actionConfig": {
    "path": "/report/user",
    "openType": "push",
    "query": {
      "userId": "{{row.id}}"
    }
  }
}
```

### 3. 外链

```json
{
  "buttonName": "访问官网",
  "actionType": "link",
  "actionConfig": {
    "path": "https://example.com"
  }
}
```

### 4. 批量操作

```json
{
  "buttonName": "批量删除",
  "actionType": "api",
  "actionConfig": {
    "url": "/api/user/batch",
    "method": "POST",
    "params": {
      "fromRow": false,
      "custom": {
        "ids": "{{selection.map(s => s.id).join(',')}}"
      }
    },
    "successAction": {
      "type": "refresh",
      "message": "批量删除成功"
    }
  }
}
```

### 5. 按钮显示条件

```
选择时才显示：selection.length > 0
只有启用状态：row.status === 1
特定角色显示：user.roles.includes('admin')
```

## 表格列格式化示例

### 1. 字典翻译

```json
{
  "columnCode": "status",
  "formatterType": "dict",
  "formatterConfig": {
    "dict": {
      "1": "启用",
      "0": "停用"
    }
  }
}
```

### 2. 金额格式化

```json
{
  "columnCode": "amount",
  "formatterType": "currency",
  "formatterConfig": {
    "symbol": "¥",
    "decimals": 2
  }
}
```

### 3. 百分比

```json
{
  "columnCode": "rate",
  "formatterType": "percent",
  "formatterConfig": {
    "decimals": 2,
    "multiply": true
  }
}
```

### 4. 状态标签

```json
{
  "columnCode": "status",
  "formatterType": "tag",
  "formatterConfig": {
    "labelMap": {
      "1": "启用",
      "0": "停用"
    },
    "typeMap": {
      "1": "success",
      "0": "danger"
    }
  }
}
```

### 5. 图片展示

```json
{
  "columnCode": "avatar",
  "formatterType": "image",
  "formatterConfig": {
    "width": "40px",
    "height": "40px"
  }
}
```

## 字段联动示例

### 配置字段联动规则

```json
{
  "triggerField": "status",
  "condition": "value === 1",
  "targetField": "remark",
  "action": "setValue",
  "value": "已启用"
}
```

### 可用的联动动作

- `setValue` - 设置字段值
- `clearValue` - 清空字段值
- `setVisible` - 设置字段可见性
- `setDisabled` - 设置字段禁用状态
- `setRequired` - 设置字段必填
- `setOptions` - 动态加载选项

## 调试技巧

### 1. 查看配置数据

```javascript
// 在浏览器控制台执行
import { usePageConfig } from '@/stores/pageConfig'
const pageConfig = usePageConfig()
console.log(pageConfig.config)
```

### 2. 查看表单数据

```javascript
// 在表单组件中
console.log('表单数据:', formData)
```

### 3. 查看按钮上下文

```javascript
// 在ButtonActionHandler中
console.log('上下文:', context)
// { row: 当前行, selection: 选中项, form: 表单数据 }
```

### 4. 监控API请求

- 打开浏览器开发者工具（F12）
- 切换到 Network 标签
- 筛选 XHR 请求
- 查看请求参数和响应

## 常见问题

**Q: 页面发布后访问404？**

A: 检查以下几点：
1. 页面状态是否为"已发布"
2. 路由路径是否正确配置
3. 菜单是否正确关联页面
4. 刷新页面重新加载路由

**Q: 弹窗无法打开？**

A: 检查以下几点：
1. 按钮配置中是否设置了formId
2. 表单配置是否存在
3. 查看浏览器控制台错误信息

**Q: 表格数据不加载？**

A: 检查以下几点：
1. API地址是否正确
2. 后端接口是否正常返回
3. 返回数据格式是否符合要求：`{ records: [], total: 0 }`

**Q: 按钮动作不执行？**

A: 检查以下几点：
1. actionConfig是否正确配置
2. API地址和参数是否正确
3. 查看控制台错误信息

## 最佳实践

1. **命名规范**
   - 页面编码：`模块_功能`，如 `user_manage`
   - 表单编码：`模块_功能_form`，如 `user_form`
   - 表格编码：`模块_功能_list`，如 `user_list`

2. **路由路径**
   - 使用小写字母和下划线
   - 格式：`/模块/功能`，如 `/user/list`

3. **按钮命名**
   - 使用清晰的动词+名词
   - 如：新增用户、编辑用户、删除用户

4. **字段验证**
   - 必填字段添加验证规则
   - 使用合适的验证类型（邮箱、手机号等）

5. **性能优化**
   - 表格大数据量使用分页
   - 查询条件添加防抖
   - 配置数据自动缓存

## 进阶功能

更多高级功能和详细说明，请参考：
- [完整测试指南](./页面配置渲染功能测试指南.md)
- [实施总结文档](./页面配置渲染功能实施总结.md)
