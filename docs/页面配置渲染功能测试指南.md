# 页面配置渲染功能测试指南

## 功能概述

本文档用于测试低代码平台的页面配置渲染功能，包括页面发布、独立路由访问、动态渲染、弹窗/抽屉管理等功能。

## 测试前准备

### 1. 数据库迁移

执行以下SQL脚本添加页面发布相关字段：

```bash
mysql -u root -p lowcode_platform < docs/migration/002_add_page_publish.sql
```

### 2. 启动后端服务

```bash
cd backend
mvn clean install
mvn spring-boot:run
```

后端服务将在 http://localhost:8080 启动

### 3. 启动前端服务

```bash
cd frontend
npm install  # 首次运行需要安装依赖
npm run dev
```

前端服务将在 http://localhost:3000 启动

### 4. 登录系统

使用管理员账号登录（默认：admin/admin123）

## 功能测试清单

### 测试一：发布和访问页面

**目的**：验证页面发布功能和独立路由访问

**步骤**：

1. **创建页面配置**
   - 进入"低代码 → 页面管理"
   - 点击"新增页面"，选择"列表页"模板
   - 输入页面名称"用户管理"，页面编码"user_manage"
   - 点击"确定"创建

2. **配置页面内容**
   - 点击页面列表中的"设计"按钮
   - 配置查询区：添加"用户名"输入框、"状态"下拉框
   - 配置内容区：选择表格组件，关联表格配置ID
   - 保存配置

3. **发布页面**
   - 返回页面管理列表
   - 点击"发布"按钮
   - 输入路由路径 `/user/list`
   - 确认发布

4. **验证发布状态**
   - 确认页面显示"已发布"标签
   - 确认路由路径显示为 `/user/list`

5. **通过菜单访问**
   - 进入"系统 → 菜单管理"
   - 新增菜单，选择"菜单"类型
   - 组件来源选择"低代码页面"
   - 选择"用户管理"页面
   - 点击"自动填充"按钮，路由路径自动填充为 `/user/list`
   - 保存菜单

6. **访问页面**
   - 刷新页面，在左侧菜单找到新创建的菜单
   - 点击菜单，验证页面正常渲染
   - 验证URL显示为 http://localhost:3000/user/list

**预期结果**：
- ✅ 页面成功发布，显示"已发布"状态
- ✅ 路由路径正确显示
- ✅ 菜单能关联低代码页面
- ✅ 通过菜单能正常访问页面
- ✅ 页面正确渲染查询区和表格

### 测试二：列表页功能

**目的**：验证列表页的查询、表格渲染、按钮功能

**步骤**：

1. **配置查询区**
   - 进入页面设计器
   - 启用查询区，添加3个字段：
     - 用户名（输入框）
     - 状态（下拉框，选项：启用/停用）
     - 创建时间（日期范围）
   - 保存配置

2. **配置表格**
   - 创建表格配置"用户列表"
   - 添加列：ID、用户名、邮箱、状态、创建时间
   - 启用分页，每页10条
   - 启用选择框
   - 保存配置

3. **配置按钮**
   - 工具栏按钮：
     - 新增（actionType: dialog，关联表单ID）
     - 批量删除（actionType: api，url: /api/user/batch）
   - 行按钮：
     - 编辑（actionType: dialog）
     - 删除（actionType: confirm + api）
   - 保存按钮配置

4. **测试查询功能**
   - 在用户名输入框输入关键词
   - 点击"查询"按钮
   - 验证表格数据正确过滤
   - 点击"重置"按钮，验证查询条件清空

5. **测试分页功能**
   - 切换每页条数
   - 点击页码切换
   - 验证表格数据正确更新

6. **测试选择功能**
   - 勾选多个复选框
   - 验证选择状态正确
   - 点击"批量删除"按钮

7. **测试按钮动作**
   - 点击"新增"按钮，验证弹窗打开
   - 点击"编辑"按钮，验证弹窗打开且数据正确加载
   - 点击"删除"按钮，验证确认框显示
   - 确认删除，验证数据刷新

**预期结果**：
- ✅ 查询条件正确传递给表格
- ✅ 分页功能正常工作
- ✅ 选择功能正常工作
- ✅ 按钮动作正确执行
- ✅ 弹窗正确打开和关闭
- ✅ 操作后表格数据刷新

### 测试三：表单页功能

**目的**：验证表单渲染和提交功能

**步骤**：

1. **创建表单配置**
   - 进入"低代码 → 表单管理"
   - 新增表单"用户表单"
   - 添加字段：
     - 用户名（input，必填）
     - 邮箱（input，必填，格式验证）
     - 手机号（input，格式验证）
     - 状态（switch）
     - 备注（textarea）
   - 设置验证规则
   - 保存表单

2. **配置表单按钮**
   - 提交按钮（actionType: api，url: /api/user，method: POST）
   - 重置按钮（actionType: custom，reset: true）
   - 保存按钮配置

3. **测试表单渲染**
   - 通过页面路由访问表单页
   - 验证所有字段正确显示
   - 验证字段标签和占位符正确

4. **测试字段验证**
   - 不填写任何内容，点击提交
   - 验证必填字段显示错误提示
   - 输入错误的邮箱格式
   - 验证格式错误提示

5. **测试表单提交**
   - 填写完整的表单数据
   - 点击提交按钮
   - 验证提交成功提示
   - 验证弹窗关闭
   - 验证列表页数据刷新

6. **测试字段联动**
   - 配置字段联动规则（如：选择状态为"启用"时，自动填充备注）
   - 验证联动规则正确执行

**预期结果**：
- ✅ 表单字段正确渲染
- ✅ 字段验证规则正确执行
- ✅ 表单数据正确提交
- ✅ 提交成功后弹窗关闭
- ✅ 列表页数据自动刷新
- ✅ 字段联动功能正常

### 测试四：左树右表布局

**目的**：验证树形结构联动表格功能

**步骤**：

1. **创建tree-table页面**
   - 新增页面，选择"左树右表"模板
   - 配置左侧树：组织架构树
   - 配置右侧表格：用户列表

2. **配置树形数据**
   - 树数据URL：`/api/dept/tree`
   - 树节点字段：id、label、children

3. **测试树形结构**
   - 验证树形结构正确显示
   - 点击树节点
   - 验证右侧表格数据根据选中节点过滤

4. **测试数据联动**
   - 点击不同层级的树节点
   - 验证表格显示对应节点的数据
   - 展开和收起树节点

**预期结果**：
- ✅ 左侧树形结构正确显示
- ✅ 树节点点击事件正确触发
- ✅ 右侧表格根据树节点过滤数据
- ✅ 展开/收起功能正常

### 测试五：弹窗和抽屉功能

**目的**：验证全局弹窗和抽屉管理

**步骤**：

1. **测试弹窗功能**
   - 配置按钮打开弹窗（actionType: dialog）
   - 点击按钮，验证弹窗打开
   - 验证弹窗标题正确
   - 验证表单在弹窗中正确渲染
   - 验证弹窗遮罩层阻止操作
   - 点击弹窗外部，验证弹窗不关闭
   - 点击取消按钮，验证弹窗关闭

2. **测试抽屉功能**
   - 配置按钮打开抽屉（actionType: drawer）
   - 点击按钮，验证抽屉从右侧滑出
   - 验证抽屉尺寸配置生效
   - 验证表单在抽屉中正确渲染
   - 点击遮罩层，验证抽屉关闭

3. **测试表单提交**
   - 在弹窗/抽屉中填写表单
   - 点击提交按钮
   - 验证loading状态显示
   - 验证提交成功后弹窗/抽屉关闭
   - 验证列表数据刷新

4. **测试多个弹窗**
   - 快速点击多个打开弹窗的按钮
   - 验证同时只有一个弹窗显示
   - 验证新弹窗会替换旧弹窗

**预期结果**：
- ✅ 弹窗正确打开和关闭
- ✅ 抽屉正确打开和关闭
- ✅ 表单在弹窗/抽屉中正确渲染
- ✅ 提交功能正常工作
- ✅ 同时只显示一个弹窗/抽屉

### 测试六：权限验证

**目的**：验证按钮权限控制

**步骤**：

1. **配置按钮权限**
   - 为按钮配置权限标识：`user:add`
   - 为按钮配置显示条件：`selection.length > 0`

2. **测试权限控制**
   - 使用没有 `user:add` 权限的用户登录
   - 验证"新增"按钮不显示
   - 使用有权限的用户登录
   - 验证"新增"按钮显示

3. **测试显示条件**
   - 不选择任何行，验证批量删除按钮禁用或隐藏
   - 选择一行或多行，验证按钮启用或显示

**预期结果**：
- ✅ 权限控制正确执行
- ✅ 显示条件正确计算
- ✅ 按钮状态正确更新

### 测试七：配置缓存

**目的**：验证配置缓存功能

**步骤**：

1. **首次加载**
   - 打开浏览器开发者工具 → Network
   - 访问页面
   - 记录API请求次数和时间

2. **二次访问**
   - 刷新页面
   - 观察API请求
   - 验证配置数据从缓存读取（请求减少）

3. **缓存失效**
   - 等待5分钟（缓存过期时间）
   - 再次刷新页面
   - 验证重新加载配置数据

**预期结果**：
- ✅ 首次加载请求配置API
- ✅ 二次访问使用缓存，请求减少
- ✅ 缓存过期后重新加载

### 测试八：性能优化

**目的**：验证大数据量场景的性能

**步骤**：

1. **表格大数据量**
   - 准备1000+条测试数据
   - 配置表格不分页或大分页
   - 测量页面加载时间
   - 测量滚动流畅度

2. **表单多字段**
   - 创建包含50+字段的表单
   - 测量表单渲染时间
   - 测量字段验证响应时间

3. **查询防抖**
   - 在查询框快速输入内容
   - 观察API请求频率
   - 验证防抖生效（500ms延迟）

**预期结果**：
- ✅ 大数据量表格渲染时间 < 2秒
- ✅ 多字段表单渲染时间 < 1秒
- ✅ 查询防抖正确工作
- ✅ 页面操作流畅，无明显卡顿

## 问题排查

### 常见问题

**1. 页面发布后访问404**
- 检查路由路径是否正确
- 检查页面状态是否为"已发布"
- 刷新页面重新加载路由
- 查看浏览器控制台错误信息

**2. 弹窗无法打开**
- 检查按钮配置中是否设置formId
- 检查弹窗管理器是否正确初始化
- 查看控制台错误信息

**3. 表格数据不刷新**
- 检查API配置是否正确
- 检查查询参数是否正确传递
- 检查后端接口返回格式

**4. 字段联动不生效**
- 检查联动规则配置是否正确
- 检查字段编码是否匹配
- 查看控制台日志

### 调试技巧

**1. 开启调试日志**
```javascript
// 在浏览器控制台执行
localStorage.setItem('debug', 'lowcode:*')
```

**2. 查看配置数据**
```javascript
// 在组件中打印配置
console.log('页面配置:', pageConfig.value)
console.log('表单数据:', formData)
```

**3. 监控API请求**
- 使用浏览器开发者工具 → Network
- 筛选XHR请求
- 查看请求参数和响应数据

## 测试报告模板

### 测试环境
- 测试人员：
- 测试日期：
- 浏览器版本：
- 后端版本：
- 前端版本：

### 测试结果

| 测试项 | 测试结果 | 问题描述 | 严重程度 |
|--------|---------|---------|---------|
| 发布和访问页面 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 列表页功能 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 表单页功能 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 左树右表布局 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 弹窗和抽屉 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 权限验证 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 配置缓存 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |
| 性能优化 | ⬜ 通过 ⬜ 失败 | | ⬜ 高 ⬜ 中 ⬜ 低 |

### 总结
- 测试通过数：___ / 8
- 发现问题数：___
- 高优先级问题：___
- 中优先级问题：___
- 低优先级问题：___

### 建议
（填写测试过程中发现的改进建议）
